<?xml version="1.0" encoding="utf-8"?>
<!-- width and height hard-coded in the root tag to better support the
     Design view in FlexBuilder since we know the width and height from the
     settings in flexstore.mxml -->
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml"
    xmlns:employeeManager="suite.view.employeeManager.components.*"
    width="990" height="550"
    currentState="showFilter">

    <mx:Script>
        <![CDATA[
        import mx.collections.ArrayCollection;
        import suite.model.vo.Employee;

        private var _roster:ArrayCollection;

        [Bindable]
        public function get roster():ArrayCollection
        {
        	trace("[ EmployeeManager.mxml ] get roster()")
            return _roster;
        }

        public function set roster(c:ArrayCollection):void
        {
        	trace("[ EmployeeManager.mxml ] set roster(ArrayCollection length:" + c.length + ")")

            _roster = c;
            if (filterPanel != null)
            {
                filterPanel.filter.count = c.length;
            }
        }

        public function addToCompare(employee:Employee):void
        {
        	trace("[ EmployeeManager.mxml ] addToCompare(employee:" + employee.name + ")")
            //setting the state before adding the employee avoids jumpiness in the transition, not sure why
            currentState = 'showFilter';
            filterPanel.employeeList.addEmployee(employee);
        }

        public function addToCart(employee:Employee):void
        {
        	trace("[ EmployeeManager.mxml ] addToCart(employee:" + employee.name + ")")
            //setting the state before adding the employee avoids jumpiness in the transition, not sure why
            currentState = 'showCart';
            cartPanel.employeeList.addEmployee(employee);
        }


        ]]>
    </mx:Script>

    <mx:HBox
        styleName="colorPanel"
        dropShadowEnabled="true"
        height="100%" width="100%"
        verticalScrollPolicy="off"
        horizontalGap="0">

        <employeeManager:Grip id="filterGrip" gripIcon="@Embed('/assets/icon_magnifier.png')"
            gripTip="Show filter panel" click="currentState = 'showFilter'"/>

        <employeeManager:EmployeeFilterPanel id="filterPanel" width="265" height="100%"
            filter="rosterPanel.filter(event.filter, event.live)"
            compare="rosterPanel.compare(filterPanel.employeeList.getEmployees())"
            creationComplete="if (roster) filterPanel.filter.count = roster.length"/>

        <mx:Spacer width="100%"/>

        <employeeManager:EmployeeCart id="cartPanel" width="265" height="100%"/>

        <employeeManager:Grip id="cartGrip" gripIcon="@Embed('/assets/icon_cart_empty.png')"
            gripTip="Show cart" click="currentState = 'showCart'"/>

    </mx:HBox>

    <employeeManager:EmployeeRosterPanel id="rosterPanel" y="4" width="685" height="540"
        roster="{roster}"
        compare="addToCompare(event.employee)"
        purchase="addToCart(event.employee)"
        cartCount="{cartPanel.numEmployees}"/>

    <mx:states>
       <mx:State name="showFilter">
          <mx:SetStyle target="{rosterPanel}" name="left" value="285"/>
       </mx:State>
       <mx:State name="showCart">
           <mx:SetStyle target="{rosterPanel}" name="right" value="285"/>
       </mx:State>
    </mx:states>

    <!--
      make sure to use transitions here instead of applying a Move effect
      to the Panel itself which will result in odd behavior
    -->
    <mx:transitions>
       <mx:Transition fromState="*" toState="*">
          <mx:Move target="{rosterPanel}" />
       </mx:Transition>
    </mx:transitions>

</mx:Canvas>
